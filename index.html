<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–í—ã–∑–≤–∞—Ç—å –≠–ª–µ–∫—Ç—Ä–∏–∫–∞ ‚ö°</title>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>

    <style>
        :root { --primary: #27ae60; --dark: #2c3e50; --light: #f4f7f6; --urgent: #e74c3c; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--light); margin: 0; padding: 15px; }
        .header { text-align: center; padding: 20px 0; }
        .order-form { background: white; padding: 20px; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        input, select, textarea { width: 100%; padding: 12px; margin: 8px 0; border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box; font-size: 16px; }
        .btn-send { background: var(--dark); color: white; border: none; padding: 15px; width: 100%; border-radius: 8px; font-weight: bold; cursor: pointer; }
        .order-card { background: white; padding: 15px; border-radius: 12px; margin-top: 10px; border-left: 5px solid #ccc; }
        .status-taken { border-left-color: var(--primary); background: #f0fff4; }
    </style>
</head>
<body>

<div class="header">
    <h1>‚ö° –≠–ª–µ–∫—Ç—Ä–æ-–®–∞–±–∞—à–∫–∞</h1>
</div>

<div class="order-form">
    <select id="city">
        <option>–ú–∞—Ö–∞—á–∫–∞–ª–∞</option>
        <option>–ö–∞—Å–ø–∏–π—Å–∫</option>
        <option>–•–∞—Å–∞–≤—é—Ä—Ç</option>
    </select>
    <textarea id="desc" rows="3" placeholder="–ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å?"></textarea>
    <input type="text" id="address" placeholder="–ê–¥—Ä–µ—Å (–£–ª–∏—Ü–∞, –¥–æ–º)">
    <input type="tel" id="phone" placeholder="+7 (900) 000-00-00">
    
    <label style="display:flex; align-items:center; gap:10px; color:var(--urgent); font-weight:bold; margin:10px 0">
        <input type="checkbox" id="urgent"> üî• –°–†–û–ß–ù–û
    </label>

    <button id="submitBtn" class="btn-send" onclick="createOrder()">–û–¢–ü–†–ê–í–ò–¢–¨ –ó–ê–Ø–í–ö–£</button>
</div>

<div id="myOrders"></div>

<script>
    // 1. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
    const firebaseConfig = {
        apiKey: "AIzaSyAjoW4lVBACbjp3a9LZTLUtjsNpFLeXArk",
        authDomain: "shabashka-8e433.firebaseapp.com",
        databaseURL: "https://shabashka-8e433-default-rtdb.firebaseio.com",
        projectId: "shabashka-8e433"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    // –ù–ê–°–¢–†–û–ô–ö–ò TELEGRAM (–í–∞—à —Ç–æ–∫–µ–Ω —É–∂–µ —Ç—É—Ç)
    const TG_TOKEN = "8497589817:AAGemGImjt0A4Kvzc2NvqB2eAbElqkR4H_Y";
    const TG_CHAT_ID = "–í–ê–®_ID_–¶–ò–§–†–ê–ú–ò"; // <--- –í–°–¢–ê–í–¨–¢–ï –°–Æ–î–ê –í–ê–® ID –ò–ó @userinfobot

    let clientId = localStorage.getItem('client_id') || ('C' + Math.floor(Math.random() * 100000));
    localStorage.setItem('client_id', clientId);

    // 2. –§—É–Ω–∫—Ü–∏—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –≤ Telegram
    async function sendToTelegram(orderData) {
        const text = `üö® *–ù–û–í–´–ô –ó–ê–ö–ê–ó*\n\n` +
                     `üèô *–ì–æ—Ä–æ–¥:* ${orderData.city}\n` +
                     `üõ† *–ß—Ç–æ:* ${orderData.desc}\n` +
                     `üìç *–ê–¥—Ä–µ—Å:* ${orderData.addr}\n` +
                     `üìû *–¢–µ–ª:* ${orderData.phone}\n` +
                     `${orderData.isUrgent ? 'üî• *–°–†–û–ß–ù–û!*' : ''}`;

        try {
            await fetch(`https://api.telegram.org/bot${TG_TOKEN}/sendMessage`, {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({ chat_id: TG_CHAT_ID, text: text, parse_mode: 'Markdown' })
            });
        } catch (e) { console.error("–û—à–∏–±–∫–∞ TG:", e); }
    }

    // 3. –û—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞
    function createOrder() {
        const desc = document.getElementById('desc').value;
        const addr = document.getElementById('address').value;
        const phone = document.getElementById('phone').value;
        const city = document.getElementById('city').value;
        const urgent = document.getElementById('urgent').checked;

        if (desc.length < 3 || addr.length < 3) return alert("–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è");

        const btn = document.getElementById('submitBtn');
        btn.disabled = true;

        const newOrderRef = db.ref('tasks').push();
        const orderData = {
            id: newOrderRef.key,
            authorId: clientId,
            city: city,
            desc: desc,
            addr: addr,
            phone: phone,
            isUrgent: urgent,
            timestamp: new Date().toLocaleString('ru-RU'),
            status: 'active'
        };

        newOrderRef.set(orderData).then(() => {
            sendToTelegram(orderData); // –û–¢–ü–†–ê–í–ö–ê –í –¢–ì
            alert("–ó–∞—è–≤–∫–∞ –ø—Ä–∏–Ω—è—Ç–∞! –ë–æ—Ç —É–∂–µ –ø–µ—Ä–µ–¥–∞–ª –µ—ë –º–∞—Å—Ç–µ—Ä—É.");
            document.getElementById('desc').value = '';
            document.getElementById('address').value = '';
            btn.disabled = false;
        });
    }

    // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∑–∞–∫–∞–∑–æ–≤ (–∫–∞–∫ –≤ –ø—Ä–æ—à–ª–æ–º –∫–æ–¥–µ)
    db.ref('tasks').on('value', (snapshot) => {
        const data = snapshot.val();
        const container = document.getElementById('myOrders');
        container.innerHTML = '<h3>–í–∞—à–∏ –∑–∞—è–≤–∫–∏:</h3>';
        if (!data) return;
        Object.values(data).reverse().forEach(task => {
            if (task.authorId === clientId) {
                const div = document.createElement('div');
                div.className = `order-card ${task.status === 'taken' ? 'status-taken' : ''}`;
                div.innerHTML = `<strong>${task.desc}</strong><br><small>üìç ${task.addr}</small><br>
                <span style="font-size:12px">${task.status === 'taken' ? '‚úÖ –ú–∞—Å—Ç–µ—Ä –≤ –ø—É—Ç–∏' : '‚è≥ –ò—â–µ–º –º–∞—Å—Ç–µ—Ä–∞...'}</span>`;
                container.appendChild(div);
            }
        });
    });
</script>
</body>
</html>
